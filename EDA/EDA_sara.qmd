---
title: "EDA_sara"
format: html
editor: source
---

# EDA

## Bibliotecas

```{r message=FALSE}
library(networkD3)
library(tidyverse)
```

## Leer datos

```{r}
elecciones_2021 <- read.csv("./../data/Elecciones MX 2021 - Captura - TODOS.csv") %>% filter(!is.null(person_id)) %>% filter(person_id!="NA")
elecciones_2024 <- read.csv("./../data/Elecciones MX 2024 - Captura - Captura.csv") %>% filter(!is.null(person_id)) %>% filter(person_id!="NA")
elecciones_2022 <- read.csv("./../data/Gobernantes MX 2022 - Captura - TODOS.csv") %>% filter(!is.null(person_id)) %>% filter(person_id!="NA")
```

## Revisar variables

```{r}
glimpse(elecciones_2021)
# unique(elecciones_2021$role_type)
# unique(elecciones_2021$contest)
```

```{r}
glimpse(elecciones_2022)
# unique(elecciones_2022$role_type)
```


```{r}
# elecciones_2021 %>% filter(!is.null(person_id))
glimpse(elecciones_2024)
# unique(elecciones_2024$role_type)
# unique(elecciones_2021$contest)
```


**ojo hay varios person_id y role_type**

# Por genero

```{r}
elecciones_2021 %>% group_by(gender) %>%  summarise(cantidad=n()) %>% 
  mutate(porcentaje=cantidad/nrow(elecciones_2021)*100)

elecciones_2022 %>% group_by(gender) %>%  summarise(cantidad=n()) %>% 
  mutate(porcentaje=cantidad/nrow(elecciones_2022)*100)

elecciones_2024 <- elecciones_2024 %>% 
  mutate(gender = ifelse(gender == "F ", "F", gender))

elecciones_2024 %>% group_by(gender) %>%  summarise(cantidad=n()) %>% 
  mutate(porcentaje=cantidad/nrow(elecciones_2021)*100)

elecciones_2024 %>% filter(gender=="")
```

**Se ha diversificado, hubo alguna ley o cuota de género??**

**Los 8 que están vacío no parecen tener género indefinido, porqué no tienen género???**



# Vivo o muerto

```{r}
elecciones_2021 %>% group_by(dead_or_alive) %>%  summarise(n())

elecciones_2022 %>% group_by(dead_or_alive) %>%  summarise(n())

elecciones_2024 <- elecciones_2024 %>% 
  mutate(dead_or_alive = ifelse(dead_or_alive == "ALIVE" | dead_or_alive == "alive" | dead_or_alive == "Alive" | dead_or_alive == "Alive ", "Vivo", dead_or_alive))

elecciones_2024 %>% group_by(dead_or_alive) %>%  summarise(n())
```

**Porqué hay tantos sin estatus de Vivo o Muerto??**

# Cargo

```{r}
elecciones_2021 %>% group_by(role_type) %>%  summarise(n())

elecciones_2022 <- elecciones_2022 %>%
  mutate(role_type = ifelse(role_type == "governmentOfficer\n", "governmentOfficer", role_type))
elecciones_2022 %>% group_by(role_type) %>%  summarise(n())

elecciones_2024 <- elecciones_2024 %>%
  mutate(role_type = ifelse(role_type == "deputyHeadOfGovernment", "headOfGovernment", role_type))
elecciones_2024 %>% group_by(role_type) %>%  summarise(n())

elecciones_2022 %>% filter(role_type=="headOfGovernment")
elecciones_2024 %>% filter(role_type=="headOfGovernment")

```

**FALTA CAMBIARLO A ESPAÑOL**
**Porqué está AMLO en el 2022 para presidente?????**

# cargo completo

```{r}
# FALTA DIVIDIR ESTA EN VARIAS COLUMNAS DE CARGO Y LUGAR

# unique(elecciones_2022$contest)
```


# Partido

**ojo, solo la ultima tabla tiene la variable party**
```{r}
elecciones_2021 %>% group_by(abbreviation) %>%  summarise(n=n()) %>% arrange(desc(abbreviation))

elecciones_2022 %>% group_by(abbreviation) %>%  summarise(n=n()) %>% arrange(desc(abbreviation))

# elecciones_2024 <- elecciones_2024 %>% 
#   mutate(dead_or_alive = ifelse(dead_or_alive == "ALIVE" | dead_or_alive == "alive" | dead_or_alive == "Alive" | dead_or_alive == "Alive ", "Vivo", dead_or_alive))

elecciones_2024 %>% group_by(abbreviation) %>%  summarise(n=n()) %>% arrange(desc(abbreviation))
```

**Son muchos partidos pensar cómo agruparlos, y porque son tantos???**

**FALTA MUCHA LIMPIEZA**


# Coalición

```{r}
elecciones_2021 %>% group_by(coalition) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(coalition) %>%  summarise(n=n()) %>% arrange(desc(n))

# elecciones_2024 <- elecciones_2024 %>% 
#   mutate(dead_or_alive = ifelse(dead_or_alive == "ALIVE" | dead_or_alive == "alive" | dead_or_alive == "Alive" | dead_or_alive == "Alive ", "Vivo", dead_or_alive))

elecciones_2024 %>% group_by(coalition) %>%  summarise(n=n()) %>% arrange(desc(n))
```

**También muchas de estas se pueden agrupar???? o no??**

# nivel de estudios

```{r}
elecciones_2021 %>% group_by(last_degree_of_studies) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 <- elecciones_2022 %>%
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "master Degree", "Master Degree", last_degree_of_studies))
elecciones_2022 %>% group_by(last_degree_of_studies) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 <- elecciones_2024 %>%
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "MASTER DEGREE", "Master Degree", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "BACHELOR’S DEGREE", "Bachelor’s Degree", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "HIGH SCHOOL", "High School", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "ELEMENTARY", "Elementary", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "PHD DEGREE", "PhD Degree", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "ASSOCIATE DEGREE", "Associate Degree", last_degree_of_studies)) %>% 
  mutate(last_degree_of_studies = ifelse(last_degree_of_studies == "UNIVERSITY 1ST PROFESSIONAL DEGREE", "University 1st Professional Degree", last_degree_of_studies)) 
elecciones_2024 %>% group_by(last_degree_of_studies) %>%  summarise(n=n()) %>% arrange(desc(n))
```

**Los vacíos son primaria incompleta??? o no dijeron qué?**

# profesion

```{r}
elecciones_2021 %>% group_by(profession_1) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_1) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_1) %>%  summarise(n=n()) %>% arrange(desc(n))
```

```{r}
elecciones_2021 %>% group_by(profession_2) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_2) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_2) %>%  summarise(n=n()) %>% arrange(desc(n))
```


```{r}
elecciones_2021 %>% group_by(profession_3) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_3) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_3) %>%  summarise(n=n()) %>% arrange(desc(n))
```

```{r}
elecciones_2021 %>% group_by(profession_4) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_4) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_4) %>%  summarise(n=n()) %>% arrange(desc(n))
```

```{r}
elecciones_2021 %>% group_by(profession_5) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_5) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_5) %>%  summarise(n=n()) %>% arrange(desc(n))
```

```{r}
elecciones_2021 %>% group_by(profession_6) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2022 %>% group_by(profession_6) %>%  summarise(n=n()) %>% arrange(desc(n))

elecciones_2024 %>% group_by(profession_6) %>%  summarise(n=n()) %>% arrange(desc(n))
```

**Idealmente pasar todo esto de las profesiones a onehot encoding**









# Merge todos


```{r}
candidatos_2021_2024 <- 
  merge(x = elecciones_2021, y = elecciones_2022, by = "person_id", suffixes = c("_2021", "_2022")) %>% 
  merge(y = elecciones_2024, by = "person_id", suffixes = c("", "_2024"))

#%>% select(full_name.x, abbreviation.x, contest.x, abbreviation.y, contest.y)
```


```{r}
glimpse(candidatos_2021_2024)

candidatos_2021_2024 %>% 
  select(person_id, full_name_2021, abbreviation_2021, contest_2021, abbreviation_2022, contest_2022, abbreviation, contest) %>% 
  arrange(person_id)
```


# Primer sankey



```{r}
sankey <- candidatos_2021_2024 %>% 
  select(person_id, full_name_2021, abbreviation_2021, contest_2021, abbreviation_2022, contest_2022, abbreviation, contest) %>% 
  mutate(abbreviation_2021=paste0(toupper(abbreviation_2021),"_2021"),
         abbreviation_2022=paste0(toupper(abbreviation_2022),"_2022"),
         abbreviation=paste0(toupper(abbreviation),"_2024")) %>% 
  mutate(brinco2022 = paste(abbreviation_2021, abbreviation_2022),
         brinco2024 = paste(abbreviation_2022, abbreviation)) %>% 
  arrange(brinco2022)

unique(sankey$abbreviation_2021)
unique(sankey$abbreviation_2022)

sankey %>% group_by(brinco2022) %>% summarise(n())
sankey %>% group_by(brinco2024) %>% summarise(n())
```


```{r}
links <- data.frame(
  anio_2021=c("MC_2021", "MORENA_2021", "PAN_2021", "PRD_2021", "PRI_2021", "PT_2021", "PVEM_2021", "MC_2022", "MORENA_2022", "MORENA_2022", "MORENA_2022", "MORENA_2022", "MORENA_2022", "PAN_2022"   , "PAN_2022", "PAN_2022", "PAN_2022", "PRD_2022", "PRD_2022", "PRD_2022", "PRD_2022", "PRI_2022", "PRI_2022", "PRI_2022", "PRI_2022" , "PT_2022"    , "PT_2022", "PT_2022"  , "PVEM_2022", "PVEM_2022"),
  cambios=  c("MC_2022", "MORENA_2022", "PAN_2022", "PRD_2022", "PRI_2022", "PT_2022", "PVEM_2022", "MC_2024", "C5_2024"    , "MC_2024"    , "MORENA_2024", "PT_2024"    , "PVEM_2024"  , "MORENA_2024", "PAN_2024",    "PRD_2024", "PRI_2024", "MC_2024" , "PAN_2024", "PRD_2024", "PRI_2024", "MC_2024" , "PAN_2024", "PRI_2024", "PVEM_2024", "MORENA_2024", "PT_2024", "PVEM_2024", "PAN_2024",  "PVEM_2024"),
  num =     c(5,57,38,5,20,13,13,  5,1,1,42,7,6,1,35,1,1,  2,1,1,1,1,1,17,1,5,3,  5,2,11)
)
```


```{r}
# A connection data frame is a list of flows with intensity for each flow
# links <- data.frame(
#   source=c("group_A","group_A", "group_B", "group_C", "group_C", "group_E"), 
#   target=c("group_C","group_D", "group_E", "group_F", "group_G", "group_H"), 
#   value=c(2,3, 2, 3, 1, 3)
#   )
 
# From these flows we need to create a node data frame: it lists every entities involved in the flow
nodes <- data.frame(
  name=c(as.character(links$anio_2021), 
  as.character(links$cambios)) %>% unique()
)
 
# With networkD3, connection must be provided using id, not using real name like in the links dataframe.. So we need to reformat it.
links$IDsource <- match(links$anio_2021, nodes$name)-1 
links$IDtarget <- match(links$cambios, nodes$name)-1
 
# Make the Network
p <- sankeyNetwork(Links = links, Nodes = nodes,
              Source = "IDsource", Target = "IDtarget",
              Value = "num", NodeID = "name", 
              sinksRight=FALSE)
p

```


# otro sankey

```{r}
candidatos_2021y2024 <- 
  merge(x = elecciones_2021, y = elecciones_2024, by = "person_id", suffixes = c("_2021", "_2024"))
```



```{r}
sankey <- candidatos_2021y2024 %>% 
  select(person_id, full_name_2021, abbreviation_2021, contest_2021, abbreviation_2024, contest_2024) %>% 
  mutate(abbreviation_2021=paste0(toupper(abbreviation_2021),"_2021"),
         # abbreviation_2022=paste0(toupper(abbreviation_2022),"_2022"),
         abbreviation_2024=paste0(toupper(abbreviation_2024),"_2024")) %>% 
  mutate(brinco2024 = paste(abbreviation_2021, abbreviation_2024)) %>% 
  arrange(brinco2024)

unique(sankey$abbreviation_2021)
# unique(sankey$abbreviation_2022)

# sankey %>% group_by(brinco2022) %>% summarise(n())
sankey %>% group_by(brinco2024) %>% summarise(n())
```


```{r}
links <- data.frame(
  anio_2021=c("C1_2021", "FXM_2021", "FXM_2021", "FXM_2021", "FXM_2021", "FXM_2021", "MC_2021", "MC_2021", "MC_2021", "MORENA_2021", 
              "MORENA_2021", "MORENA_2021", "MORENA_2021", "MORENA_2021", "MORENA_2021", "PANAL_2021", "PAN_2021", "PAN_2021", "PAN_2021", "PAN_2021",
              "PAN_2021", "PAN_2021", "PESOL_2021", "PRD_2021", "PRD_2021", "PRD_2021", "PRD_2021", "PRD_2021", "PRI_2021", "PRI_2021", 
              "PRI_2021", "PRI_2021", "PRI_2021", "PRI_2021", "PT_2021", "PT_2021", "PT_2021", "PT_2021", "PVEM_2021", "PVEM_2021", 
              "PVEM_2021", "RSP_2021", "RSP_2021"),
  cambios=  c("MC_2024", "MC_2024", "PAN_2024", "PRD_2024", "PT_2024", "PVEM_2024", "MC_2024", "PAN_2024", "PRD_2024", "C5_2024",
              "MC_2024", "MORENA_2024"    , "PQS_2024"  , "PT_2024", "PVEM_2024",    "MC_2024", "MC_2024", "MORENA_2024" , "PAN_2024", "PRD_2024",
              "PRI_2024", "PVEM_2024" , "MC_2024", "MC_2024", "PAN_2024", "PRD_2024", "PRI_2024", "PVEM_2024", "MC_2024", "MORENA_2024",  
              "PAN_2024", "PRD_2024", "PRI_2024", "PVEM_2024", "MC_2024", "MORENA_2024", "PT_2024", "PVEM_2024", "MC_2024", "PAN_2024", 
              "PVEM_2024", "PAN_2024", "PT_2024"),
  num =     c(2,1,1,1,2,1,23,6,1,1,     1,58,1,10,10,1,1,2,43,2,     3,1,1,4,1,4,4,1,2,2,     2,1,33,1,1,9,6,5,1,2,    14,1,1)
)
```



```{r}
# From these flows we need to create a node data frame: it lists every entities involved in the flow
nodes <- data.frame(
  name=c(as.character(links$anio_2021), 
  as.character(links$cambios)) %>% unique()
)
 
# With networkD3, connection must be provided using id, not using real name like in the links dataframe.. So we need to reformat it.
links$IDsource <- match(links$anio_2021, nodes$name)-1 
links$IDtarget <- match(links$cambios, nodes$name)-1
 
# Make the Network
p <- sankeyNetwork(Links = links, Nodes = nodes,
              Source = "IDsource", Target = "IDtarget",
              Value = "num", NodeID = "name", 
              sinksRight=FALSE)
p

```


# otras ideas

esta relacionado el cargo con el nivel de estudios

esta relacionada el partido con el nivel de estudios

lugar con partido

periodico, palabras, candidatos

periodico, palabras, debate


